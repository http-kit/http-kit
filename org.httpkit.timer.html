<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>org.httpkit.timer documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Http-kit</span> <span class="project-version">2.8.0-beta3</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>org</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>httpkit</span></div></div></li><li class="depth-3 branch"><a href="org.httpkit.client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>client</span></div></a></li><li class="depth-3 branch"><a href="org.httpkit.encode.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>encode</span></div></a></li><li class="depth-3 branch"><a href="org.httpkit.server.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>server</span></div></a></li><li class="depth-3 branch"><a href="org.httpkit.sni-client.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sni-client</span></div></a></li><li class="depth-3 branch current"><a href="org.httpkit.timer.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>timer</span></div></a></li><li class="depth-3"><a href="org.httpkit.utils.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>utils</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="org.httpkit.timer.html#var-cancel"><div class="inner"><span>cancel</span></div></a></li><li class="depth-1"><a href="org.httpkit.timer.html#var-schedule-task"><div class="inner"><span>schedule-task</span></div></a></li><li class="depth-1"><a href="org.httpkit.timer.html#var-with-timeout"><div class="inner"><span>with-timeout</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">org.httpkit.timer</h1><div class="doc"><pre class="plaintext">TimerService wrapper:
* Can schedule many tasks at once.
* When scheduled for 1000ms, may run in 1000ms, 10001ms, etc.
* Cancel returns true =&gt; future task guaranteed cancelled;
        returns false =&gt; already cancelled || already run.
* Scheduling a new task is O(log(N)) where N is # active tasks.
* Cancelling a task is O(N).
* Timer-service thread will kill itself automatically when no task is
  scheduled for 4 minutes, and will restart automatically when a new task
  is added.</pre></div><div class="public anchor" id="var-cancel"><h3>cancel</h3><div class="usage"><code>(cancel task)</code></div><div class="doc"><pre class="plaintext"></pre></div></div><div class="public anchor" id="var-schedule-task"><h3>schedule-task</h3><h4 class="type">macro</h4><div class="usage"><code>(schedule-task ms &amp; body)</code></div><div class="doc"><pre class="plaintext">Schedules body for invocation after given time and returns a
CancelableFutureTask. `(cancel task)` will cancel the task if possible and
return true iff cancellation was successful.

  (let [task (schedule-task 800 (println "Task triggered"))]
    (Thread/sleep (rand-nth [900 700]))
    (when (cancel task) ; Returns true iff task successfully cancelled
      (println "Task was cancelled")))</pre></div></div><div class="public anchor" id="var-with-timeout"><h3>with-timeout</h3><h4 class="type">macro</h4><div class="usage"><code>(with-timeout f ms timeout-form &amp; body)</code></div><div class="doc"><pre class="plaintext">Schedules timeout-form for invocation after given timeout and wraps named
fn so that calling it with any arguments also cancels the timeout if possible.
If the timeout has already been invoked, the fn will not run and will
immediately return nil.

  (with-timeout println 800 (println "Timeout task triggered")
    (Thread/sleep (rand-nth [900 700]))
    (println "Timeout task was cancelled"))</pre></div></div></div></body></html>